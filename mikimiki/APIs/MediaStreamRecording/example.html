<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        button{
            padding:15px;
        }
        section{
            padding:15px;
            border:red dashed 1px;
        }
        .clip{
            background-color:rgba(255,240,0,.3);
        }
    </style>
</head>
<body>
<button id="record">record</button>
<button id="stop">stop</button>
<section id="soundClips"></section>
<script type="text/javascript">
    document.addEventListener("DOMContentLoaded",function (){
        const record = this.getElementById("record");
        const stop = this.getElementById("stop");
        const soundClips = this.getElementById("soundClips");
        if (navigator.mediaDevices) {
            console.log('getUserMedia supported.');

            var constraints = { audio: true,video:true };
            var chunks = [];

            navigator.mediaDevices.getUserMedia(constraints)
                .then(function(stream) {

                    var mediaRecorder = new MediaRecorder(stream);

                    //visualize(stream);

                    record.onclick = function() {
                        mediaRecorder.start();
                        console.log(mediaRecorder.state);
                        console.log("recorder started");
                        record.style.background = "red";
                        record.style.color = "black";
                    }

                    stop.onclick = function() {
                        mediaRecorder.stop();
                        console.log(mediaRecorder.state);
                        console.log("recorder stopped");
                        record.style.background = "";
                        record.style.color = "";
                    }

                    mediaRecorder.onstop = function(e) {
                        console.log("data available after MediaRecorder.stop() called.");

                        var clipName = prompt('Enter a name for your sound clip');

                        var clipContainer = document.createElement('article');
                        var clipLabel = document.createElement('p');
                        var video = document.createElement('video');
                        var deleteButton = document.createElement('button');

                        clipContainer.classList.add('clip');
                        video.setAttribute('controls', '');
                        deleteButton.innerHTML = "Delete";
                        clipLabel.innerHTML = clipName;

                        clipContainer.appendChild(video);
                        clipContainer.appendChild(clipLabel);
                        clipContainer.appendChild(deleteButton);
                        soundClips.appendChild(clipContainer);

                        video.controls = true;
                        var blob = new Blob(chunks, { 'type' : 'video/ogg; codecs=opus' });
                        chunks = [];
                        var videoURL = URL.createObjectURL(blob);
                        video.src = videoURL;
                        console.log("recorder stopped");

                        deleteButton.onclick = function(e) {
                            evtTgt = e.target;
                            evtTgt.parentNode.parentNode.removeChild(evtTgt.parentNode);
                        }
                    }

                    mediaRecorder.ondataavailable = function(e) {
                        chunks.push(e.data);
                    }
                })
                .catch(function(err) {
                    console.log('The following error occurred: ' + err);
                })
        }

    })
</script>
</body>
</html>